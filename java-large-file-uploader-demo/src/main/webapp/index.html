<html>
<head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>
<script src="./js/javalargefileuploader.js"></script>
<script type="text/javascript">
$(document).ready(function() {
	
	//construct object
	jlfu = new JavaLargeFileUploader();
	
	//call the initializing function
	jlfu.initialize(
			true, //Yes I want first chunk of file validation
			function(pendingFiles) {
		
		//if we have some pending uploads 
    	if (!jQuery.isEmptyObject(pendingFiles)) {
    		
    		var i = 0;
			//iterate over all the pending file uploads
    		$.each(pendingFiles, function(fileId,pendingFile) {
    			
		  		//get container div element
		  		var div = document.getElementById('container'+i);
		  		
    			//if the file is complete
			  	if (pendingFile.fileComplete) {
			  		//specify it in the em element
			  		setTextToEm(div, "The file '"+pendingFile.originalFileName+"' has been fully uploaded ("+pendingFile.fileCompletion+"/"+pendingFile.originalFileSize+").");
			  	} 
    			
    			//if incomplete and pending 
			  	else if (pendingFile.fileCompletion) {
			  		
			  		//describe the file so that the user can select it again
				  	setTextToEm(div, 
				  		"The file '"+pendingFile.originalFileName+"' has been partially uploaded ("+pendingFile.fileCompletion+"/"+pendingFile.originalFileSize+"). Reselect it to continue uploading it or cancel it.");
				  		
			  		//and assign the fileId as the name of the fileupload html element
				  	div.children[0].name = fileId;
			  		
			  		//set if there is a rate configured
				  	 div.children[4].value = pendingFile.rateInKiloBytes;
			  		
			  	}
    			i++;
		   	}); 
    	}
    	
	}, function(message) {
		alert(message);
	});
	
	//add the listeners on all the file upload elements
	for (i=0;i<=3;i++) {
		
		//add a change listener on the fileupload to manage a file upload directly when the user selects the file
	  	document.getElementById("container"+i).children[0].addEventListener("change", function(e) {
	  		
	  		//process the file upload
	  		jlfu.fileUploadProcess(e.target, 
	  			
	  			//define a start callback
	  			function(theFileId, origin) {
	  				//assign the name of the element to keep a reference to the file id
	  				origin.name = theFileId;
	  			},		
	  				
	  			//define a progressCallback showing the progress in the em element 
				function(theFileId, percentageCompleted, uploadRate, origin) {
	  				setTextToEm(origin.parentElement, "Uploading... ("+percentageCompleted+"% complete) | Uploading at "+uploadRate + " per second.");
		  		}, 
	  			
		  		//define a finishCallback showing the completion in the em element 
		  		function(theFileId, origin) {
		  			setTextToEm(origin.parentElement, "Upload completed.");
		  		}, 
		  		
		  		//define an exception callback
		  		function(message, origin) {
		  			setTextToEm(origin.parentElement, message);
		  		},
		  		
		  		e.target.name);
	  		
	  	}, false);
	}
	
 
});
function setTextToEm(div, text) {
	div.children[2].textContent=text;
}
function getFileId(div) {
	return div.children[0].name;
}
</script>
</head>
<body>

	<div id="container0">
		<input type="file"/><br/> 
		<em></em><br>
		Limit the upload bandwith to <input type="text"/> KB <button onclick="jlfu.setRateInKiloBytes(getFileId(this.parentElement), this.parentElement.children[4].value);">Set rate</button>	<br>	
  		<a href='javascript:void(0)' onclick='jlfu.cancelFileUpload(getFileId(this.parentElement)); setTextToEm(this.parentElement, "");'>Cancel</a>
  		<a href='javascript:void(0)' onclick='jlfu.pauseFileUpload(getFileId(this.parentElement)); setTextToEm(this.parentElement, "Paused");'>Pause</a>
  		<a href='javascript:void(0)' onclick='jlfu.resumeFileUpload(getFileId(this.parentElement)); setTextToEm(this.parentElement, "Resuming...");'>Resume</a>
	</div>
	
	<hr>
	
	<div  id="container1">
		<input type="file"/><br/> 
		<em></em><br>
		Limit the upload bandwith to <input type="text"/> KB <button onclick="jlfu.setRateInKiloBytes(getFileId(this.parentElement), this.parentElement.children[4].value);">Set rate</button>	<br>	
  		<a href='javascript:void(0)' onclick='jlfu.cancelFileUpload(getFileId(this.parentElement)); setTextToEm(this.parentElement, "");'>Cancel</a>
  		<a href='javascript:void(0)' onclick='jlfu.pauseFileUpload(getFileId(this.parentElement)); setTextToEm(this.parentElement, "Paused");'>Pause</a>
  		<a href='javascript:void(0)' onclick='jlfu.resumeFileUpload(getFileId(this.parentElement)); setTextToEm(this.parentElement, "Resuming...");'>Resume</a>
 	</div>

	<hr>
	
	<div  id="container2">
		<input type="file"/><br/> 
		<em></em><br>
		Limit the upload bandwith to <input type="text"/> KB <button onclick="jlfu.setRateInKiloBytes(getFileId(this.parentElement), this.parentElement.children[4].value);">Set rate</button>	<br>	
  		<a href='javascript:void(0)' onclick='jlfu.cancelFileUpload(getFileId(this.parentElement)); setTextToEm(this.parentElement, "");'>Cancel</a>
  		<a href='javascript:void(0)' onclick='jlfu.pauseFileUpload(getFileId(this.parentElement)); setTextToEm(this.parentElement, "Paused");'>Pause</a>
  		<a href='javascript:void(0)' onclick='jlfu.resumeFileUpload(getFileId(this.parentElement)); setTextToEm(this.parentElement, "Resuming...");'>Resume</a>
 	</div>
	
	<hr>

	<div  id="container3">
		<input type="file"/><br/> 
		<em></em><br>
		Limit the upload bandwith to <input type="text"/> KB <button onclick="jlfu.setRateInKiloBytes(getFileId(this.parentElement), this.parentElement.children[4].value);">Set rate</button>	<br>	
  		<a href='javascript:void(0)' onclick='jlfu.cancelFileUpload(getFileId(this.parentElement)); setTextToEm(this.parentElement, "");'>Cancel</a>
  		<a href='javascript:void(0)' onclick='jlfu.pauseFileUpload(getFileId(this.parentElement)); setTextToEm(this.parentElement, "Paused");'>Pause</a>
  		<a href='javascript:void(0)' onclick='jlfu.resumeFileUpload(getFileId(this.parentElement)); setTextToEm(this.parentElement, "Resuming...");'>Resume</a>
	</div>
	
	<hr>

	<div>
		<a href='javascript:void(0)' onclick='jlfu.clearFileUpload(function(e) {window.location.reload();});'>Clear all</a>
	</div>
	
</body>
</html>